extends ../includes/defaultBody

block content
  .row
    .col-md-12
      .card
        .card-header
          h4.card-title=cardHeader
        .card-body
          .text-right.mb-4
            if targetData && targetData.id && targetData.id != ""
              button.ml-4.btn.btn-sm.btn-outline-danger.btn-round.float-left(type='button',onclick=`Dynajax('bolgeler','f',formBasarili,false,{id:${targetData.id},method:'delete'},true)`) 
                i.ti-check-box.mr-1    
                =l.getLanguage("sil")    
            a(href='/dashboard')
              button.ml-4.btn.btn-sm.btn-info.btn-outline-primary.btn-round(type='button') 
                i.ti-direction.mr-1  
                =l.getLanguage("vazgec") 
          .row
            .col-md-8
              .row
                .col-md-12
                  .form-group.has-label
                    label
                      =l.getLanguage("duyuruBaslik")
                    input.form-control(ajax-key="f",name='duyuruBaslik', type='text')
                .col-md-12
                  .form-group.has-label
                    label
                      =l.getLanguage("duyuruAciklama")
                    div.form-control(ajax-key="f",name='duyuruAciklama', type='editor')
            .col-md-4
              .row
                .col-md-11
                  .form-group.has-label
                    label
                      =l.getLanguage("bolgeId")
                    select#bolgeler.custom-select(connect-whoami="id",connect-hash=bolgelerHash)
                      option(value='',selected)=l.getLanguage("seciniz")
                        each val in bolgeler
                            option(value=val.id) 
                                =val.bolgeAdi
                .col-md-11.prettyBorder
                  .form-group.has-label
                    .form-check
                      label.form-check-label
                        input.form-check-input(type='checkbox' value="selectAll")
                        span.form-check-sign=l.getLanguage("kullanicilar")
                  .checkboxLayer
                    each val in kullanicilar
                      .form-check
                        label.form-check-label
                          input.form-check-input(ajax-key="f",type='checkbox', value=val.id, name="duyuruGidecekIdler")
                          span.form-check-sign=val.kullaniciIsim+" "+val.kullaniciSoyisim
          .text-right.mb-4
            button.ml-4.btn.btn-sm.btn-success.btn-outline-success.btn-round(type='button',onclick=`Dynajax('duyuru','f',formBasarili,true,{id:${targetData && targetData.id?targetData.id:null},method:'${targetData && targetData.id?'update':'create'}'})`) 
              i.ti-check-box.mr-1  
              =l.getLanguage("kaydet") 
  script.
    function specialPageScript(){
      $("body").delegate("#bolgeler","change",function(){
          var hash=$(this).attr("connect-hash");
          var whoAmI=$(this).attr("connect-whoami");
          var val=$(this).val();
          DynData({[whoAmI]:val},hash,function(result){
            $(`.checkboxLayer input[type='checkbox']`).prop('checked', false);
            try{
              for(item of JSON.parse(result[0].sorumluId)){
                $(`.checkboxLayer input[type='checkbox'][value='${item}']`).prop('checked', true);
              }
            }catch(err){

            }
          });
      });
      $("input[type='checkbox'][value='selectAll']").click(function(){
        $(`.checkboxLayer input[type='checkbox']`).prop('checked', $(this).prop('checked'));
      });
    }
      